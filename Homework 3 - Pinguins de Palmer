library(palmerpenguins);

penguins_data <-na.omit(penguins)

# Plotagem do gráfico de dispersão
plot(penguins_data$body_mass_g, penguins_data$bill_length_mm,
     pch = 16, col = rgb(0, 0, 1, 0.5),
     main = "Massa Corporal vs. Comprimento do Bico",
     xlab = "Massa Corporal (g)",
     ylab = "Comprimento do Bico (mm)")

# Adição de grade para facilitar a leitura das coordenadas
grid(nx = NULL, ny = NULL, col = "lightgray", lty = "dotted")

# Ajuste do modelo de regressão linear simples
modelo_linear <- lm(bill_length_mm ~ body_mass_g, data = penguins_data)

# Exibição dos coeficientes estimados e estatísticas de teste
summary(modelo_linear)

# Inclusão da reta de regressão (cor vermelha) sobre o gráfico de dispersão
abline(modelo_linear, col = "red", lwd = 2)

# Extração dos resíduos do modelo ajustado
residuos <- residuals(modelo_linear)

# Cálculo da Raiz do Erro Quadrático Médio (RMSE)
rmse_val <- sqrt(mean(residuos^2))

# Obtenção do Coeficiente de Determinação (R2)
r2_val <- summary(modelo_linear)$r.squared

# Representação gráfica dos resíduos
plot(predict(modelo_linear), residuos,
     pch = 16, col = rgb(0.3, 0.3, 0.3, 0.6),
     main = "Gráfico de Resíduos: Valores Preditos vs. Erros",
     xlab = "Valores Preditos (mm)",
     ylab = "Resíduos (mm)")
abline(h = 0, col = "red", lwd = 2, lty = 2)
grid(col = "lightgray", lty = "dotted")

#=======================

# Criacao de uma copia do dataset para teste de robustez
penguins_outlier <- penguins_data

# Introducao do outlier (Pinguim 1: massa 3750g | bico: 39.1mm -> 80.0mm)
penguins_outlier[1, "bill_length_mm"] <- 80.0

# Ajuste do novo modelo com os dados modificados
modelo_outlier <- lm(bill_length_mm ~ body_mass_g, data = penguins_outlier)

# Visualizacao comparativa: Dados Originais vs. Retas de Ajuste
plot(penguins_data$body_mass_g, penguins_data$bill_length_mm,
     pch = 16, col = rgb(0.5, 0.5, 0.5, 0.3),
     main = "Analise de Sensibilidade: Impacto de um Outlier",
     xlab = "Massa Corporal (g)", ylab = "Comprimento do Bico (mm)")

# Reta Original (Item 2) em Azul
abline(modelo_linear, col = "blue", lwd = 2)

# Reta com Outlier (Item 4) em Vermelho Tracejado
abline(modelo_outlier, col = "red", lwd = 2, lty = 2)

# Legenda Tecnica
legend("topleft", legend = c("Modelo Original", "Modelo com Outlier"),
       col = c("blue", "red"), lty = c(1, 2), lwd = 2, bty = "n")
grid(col = "lightgray", lty = "dotted")
